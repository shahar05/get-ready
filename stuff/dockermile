# Build Stage
FROM golang:1.21 AS builder

WORKDIR /app

COPY go.mod ./
COPY go.sum ./
RUN go mod download

COPY . .
RUN go build -o main .

# Final Stage
FROM alpine:3.16

WORKDIR /app

COPY --from=builder /app/main .
COPY wait-for.sh .
COPY app.env .
COPY start.sh .

RUN chmod +x /app/main
RUN apk add --no-cache netcat-openbsd

# Debugging: Check if 'main' file exists and is executable
RUN ls -l /app && file /app/main

CMD ["/app/start.sh"]
